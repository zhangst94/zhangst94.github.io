(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{381:function(a,s,e){"use strict";e.r(s);var t=e(4),r=Object(t.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"什么是hpa"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#什么是hpa"}},[a._v("#")]),a._v(" 什么是HPA？")]),a._v(" "),s("p",[a._v("Horizontal Pod Autoscaler")]),a._v(" "),s("p",[a._v("水平 pod 自动伸缩器")]),a._v(" "),s("p",[a._v("k8s 不推荐使用 VPA，因为节点有很多，推荐将流量分发到不同的节点上，而不是分发到同一个节点上")]),a._v(" "),s("ul",[s("li",[a._v("HPA v1为稳定版自动水平伸缩，只支持CPU指标")]),a._v(" "),s("li",[a._v("V2为beta版本，分为v2beta1(支持CPU、内存和自定义指标)")]),a._v(" "),s("li",[a._v("v2beta2(支持CPU、内存、自定义指标Custom和额外指标ExternalMetrics)")])]),a._v(" "),s("h2",{attrs:{id:"自动扩缩容hpa实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#自动扩缩容hpa实践"}},[a._v("#")]),a._v(" 自动扩缩容HPA实践")]),a._v(" "),s("ul",[s("li",[a._v("必须安装metrics-server或其他自定义metrics-server")]),a._v(" "),s("li",[a._v("必须配置requests参数")]),a._v(" "),s("li",[a._v("不能扩容无法缩放的对象，比如DaemonSet")])]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl create deployment hpa-nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--image")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("nginx:1.20.0 --dry-run"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("client "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("80")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("创建")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl create hpa-nginx.yaml\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("暴露一个服务")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl expose deployment hpa-nginx "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--port")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("801")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("配置autoscale")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("kubectl autoscale deployment hpa-nginx --cpu-percent"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--min")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--max")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("101")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("p",[a._v("循环执行提高cpu，暂停后cpu下降")]),a._v(" "),s("div",{staticClass:"language-shell line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("while")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[a._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("do")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-q")]),a._v(" -O- http://192.168.42.44 "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" /dev/null"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("done")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])])}),[],!1,null,null,null);s.default=r.exports}}]);