(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{428:function(s,t,a){"use strict";a.r(t);var n=a(4),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"nightingale-categraf采集器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nightingale-categraf采集器"}},[s._v("#")]),s._v(" Nightingale-Categraf采集器")]),s._v(" "),t("p",[s._v("​        Categraf 是一个监控采集 Agent，类似  Telegraf、Grafana-Agent、Datadog-Agent，希望对所有常见监控对象提供监控数据采集能力，采用 All-in-one 的设计，不但支持指标采集，也希望支持日志和调用链路的数据采集。")]),s._v(" "),t("p",[t("strong",[s._v("categraf 和 telegraf、exporters、grafana-agent、datadog-agent 对比")])]),s._v(" "),t("ul",[t("li",[s._v("支持 remote_write 写入协议，支持将数据写入 promethues、M3DB、VictoriaMetrics、InfluxDB")]),s._v(" "),t("li",[s._v("指标数据只采集数值，不采集字符串，标签维持稳态结构")]),s._v(" "),t("li",[s._v("采用 all-in-one 的设计，所有的采集工作用一个 agent 搞定，未来也可以把日志和 trace 的采集纳入 agent")]),s._v(" "),t("li",[s._v("纯 Go 代码编写，静态编译依赖少，容易分发，易于安装")]),s._v(" "),t("li",[s._v("尽可能落地最佳实践，不需要采集的数据无需采集，针对可能会对时序库造成高基数的问题在采集侧做出处理")]),s._v(" "),t("li",[s._v("常用的采集器，不但提供采集能力，还要整理出监控大盘和告警规则，用户可以直接导入使用")])]),s._v(" "),t("p",[s._v("Categraf下载地址：https://flashcat.cloud/download/categraf/")]),s._v(" "),t("h2",{attrs:{id:"categraf-配置详解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#categraf-配置详解"}},[s._v("#")]),s._v(" Categraf 配置详解")]),s._v(" "),t("p",[s._v("Categraf 配置文件在conf 目录，conf 下有一个主配置文件：config.toml，定义机器名、全局采集频率、全局附加标签、remote write  backend地址等；另外就是各种采集插件的配置目录，以input.打头，如果某个采集器 xx 不想启用，把 input.xx  改个其他前缀(或者删除这个目录)，比如 bak.input.xx，categraf 就会忽略这个采集器。")]),s._v(" "),t("p",[s._v("categraf启动时 可以通过"),t("code",[s._v("-configs")]),s._v("参数指定配置目录，如果不指定，会默认读取工作目录下的conf。 conf 目录结构如下：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("config.toml")]),s._v(" # 主配置")]),s._v(" "),t("li",[t("code",[s._v("logs.toml")]),s._v(" # logs-agent 配置")]),s._v(" "),t("li",[t("code",[s._v("prometheus.toml")]),s._v(" # prometheus agent 配置")]),s._v(" "),t("li",[t("code",[s._v("traces.yaml")]),s._v(" # trace-agent 配置")]),s._v(" "),t("li",[t("code",[s._v("conf/input.*/*.toml")]),s._v(" 插件配置文件")])]),s._v(" "),t("h2",{attrs:{id:"config-toml配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#config-toml配置"}},[s._v("#")]),s._v(" config.toml配置")]),s._v(" "),t("div",{staticClass:"language-toml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("global")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动的时候是否在stdout中打印配置内容")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("print_configs")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 机器名，作为本机的唯一标识，会为时序数据自动附加一个 agent_hostname=$hostname 的标签")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# hostname 配置如果为空，自动取本机的机器名")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# hostname 配置如果不为空，就使用用户配置的内容作为hostname")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用户配置的hostname字符串中，可以包含变量，目前支持两个变量，")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $hostname 和 $ip，如果字符串中出现这两个变量，就会自动替换")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# $hostname 自动替换为本机机器名，$ip 自动替换为本机IP")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 建议大家使用 --test 做一下测试，看看输出的内容是否符合预期")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里配置的内容，再--test模式下，会显示为 agent_hostname=xxx 的标签 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("hostname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否忽略主机名的标签，如果设置为true，时序数据中就不会自动附加agent_hostname=$hostname 的标签")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("omit_hostname")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 时序数据的时间戳使用ms还是s，默认是ms，是因为remote write协议使用ms作为时间戳的单位")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("precision")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ms"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 全局采集频率，15秒采集一次   ## 配置为数字，单位是秒，配置成字符串，就要给出单位："60s"、"1m"、“1h”')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("interval")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全局附加标签，一行一个，这些写的标签会自动附到时序数据上")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# [global.labels]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# region = "shanghai"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# env = "localhost"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认的log输出，到标准输出(stdout) ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果指定为文件, 则写入到指定的文件中")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("file_name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stdout"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# options below will not be work when file_name is stdout or stderr")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果是写入文件，最大写入大小，单位是MB")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("max_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# max_age is the maximum number of days to retain old log files based on the timestamp encoded in their filename.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保留多少天的日志文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("max_age")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# max_backups is the maximum number of old log files to retain.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 保留多少个日志文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("max_backups")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# local_time determines if the time used for formatting the timestamps in backup files is the computer's local time.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否使用本地时间")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("local_time")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Compress determines if the rotated log files should be compressed using gzip.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否将老文件压缩（gzip格式)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("compress")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发给后端的时序数据，会先被扔到 categraf 内存队列里，每个采集插件一个队列")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chan_size 定义了队列最大长度")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# batch 是每次从队列中取多少条，发送给后端backend")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("writer_opt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# default: 2000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("batch")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# channel(as queue) size")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("chan_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 后端backend配置，在toml中 [[]] 表示数组，所以可以配置多个writer")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每个writer可以有不同的url，不同的basic auth信息")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("writers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意端口号")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v5版本端口是19000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# v6版本端口是17000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("url")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:19000/prometheus/v1/write"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Basic auth username")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("basic_auth_user")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Basic auth password")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("basic_auth_pass")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# timeout settings, unit: ms")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("dial_timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("max_idle_conns_per_host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否开启push gateway")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("http")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("enable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("address")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('":9100"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("print_access")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("run_mode")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"release"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否启用告警自愈agent")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("ibex")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("enable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ibex flush interval")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("interval")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1000ms"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## n9e ibex server rpc address")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("servers")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1:20090"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## temp script dir")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("meta_dir")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./meta"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 心跳上报（附带资源信息,对象列表中使用）给夜莺v6")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果是v5版本，这里不需要保留")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("heartbeat")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("enable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# report os version cpu.util mem.util metadata")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("url")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://127.0.0.1:17000/v1/n9e/heartbeat"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# interval, unit: s")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("interval")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Basic auth username")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("basic_auth_user")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Basic auth password")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("basic_auth_pass")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Optional headers")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# headers = ["X-From", "categraf", "X-Xyz", "abc"]')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# timeout settings, unit: ms")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("dial_timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2500")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("max_idle_conns_per_host")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br"),t("span",{staticClass:"line-number"},[s._v("101")]),t("br"),t("span",{staticClass:"line-number"},[s._v("102")]),t("br"),t("span",{staticClass:"line-number"},[s._v("103")]),t("br"),t("span",{staticClass:"line-number"},[s._v("104")]),t("br"),t("span",{staticClass:"line-number"},[s._v("105")]),t("br"),t("span",{staticClass:"line-number"},[s._v("106")]),t("br"),t("span",{staticClass:"line-number"},[s._v("107")]),t("br"),t("span",{staticClass:"line-number"},[s._v("108")]),t("br"),t("span",{staticClass:"line-number"},[s._v("109")]),t("br"),t("span",{staticClass:"line-number"},[s._v("110")]),t("br"),t("span",{staticClass:"line-number"},[s._v("111")]),t("br"),t("span",{staticClass:"line-number"},[s._v("112")]),t("br"),t("span",{staticClass:"line-number"},[s._v("113")]),t("br"),t("span",{staticClass:"line-number"},[s._v("114")]),t("br"),t("span",{staticClass:"line-number"},[s._v("115")]),t("br"),t("span",{staticClass:"line-number"},[s._v("116")]),t("br"),t("span",{staticClass:"line-number"},[s._v("117")]),t("br"),t("span",{staticClass:"line-number"},[s._v("118")]),t("br"),t("span",{staticClass:"line-number"},[s._v("119")]),t("br")])]),t("h2",{attrs:{id:"conf-logs-toml-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#conf-logs-toml-配置"}},[s._v("#")]),s._v(" conf/logs.toml 配置")]),s._v(" "),t("div",{staticClass:"language-toml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("logs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# api_key http模式下生效,用于鉴权, 其他模式下占位符")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("api_key")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"TCXDuFMmYKPBaruXzWeDwyKFpk4gxslz"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否开启log-agent")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("enable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志发送到哪  send_to 表示推送的目标地址。 ## 当send_type 为kafka类型时，send_to地址支持逗号分割的broker地址列表，topic选项为指定的kafka topic。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("send_to")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"47.111.118.27:9090"')]),s._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 接受日志的后端类型,tcp,http,kafka  ## send_type 表示推送目标地址的类型，支持kafka/tcp/http，")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("send_type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志对应的topic ,kafka模式下生效")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("topic")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test_log_topic"')]),s._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否压缩  ## use_compress 表示压缩发送，http下支持gzip压缩 tcp协议支持zlib压缩")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("use_compress")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否采用tls发送")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("send_with_tls")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 批量发送的等待时间")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("batch_wait")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# categraf 记录日志偏移的目录，需要有写权限")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("run_path")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxxx"')]),s._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最大打开的文件数   ## categraf单个进程 最大同时打开的日志限制，默认100个文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("open_files_limit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 扫描目录的周期")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("scan_period")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("  \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# udp采集的帧大小")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("frame_size")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否采集pod的stdout/stderr日志")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("collect_container_all")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只采集哪些pod的stdout/stderr")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## name:log-demo 表示采集container name匹配log-demo字符的pod    正则匹配")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## image:xxx 表示采集image 匹配 xxx的pod")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## namespace:xxxx 表示采集namespace 匹配xxx下的pod")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("container_include")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 排除哪些pod的stdout/stderr  ## 如果只采集某些pod的日志，需要将container_exclude=["name:.*"] 同时配置上。')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("container_exclude")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全局处理规则, 该处不支持多行合并。多行日志合并需要在logs.items中配置")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("logs.processing_rules")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n   "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exclude_at_match"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exclude_xxx_users"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("pattern")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\\\w+@flashcat.cloud"')]),s._v(" \n  \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志采集配置")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("logs.items")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志类型 file  ## 采集的类型，当前主要支持file 和 journald。")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"file"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志路径，支持统配符，用统配符，默认从最新位置开始采集")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxxx"')]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志的label 标识日志来源的模块")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("source")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tomcat"')]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志的label 标识日志来源的服务")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("service")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my_service"')]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其他额外想加的tag ")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("tags")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"monitoring=test"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"k=v"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kafka 模式下,给单个日志处理项配置不同于全局的topic")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果不配置，则使用全局topic ")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("topic")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"xxxx"')]),s._v("  \n\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志处理规则")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("logs.items.log_processing_rules")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 表示日志中匹配到@flashcat.cloud 的行 不发送 ")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exclude_at_match"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"exclude_xxx_users"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("pattern")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\\\w+@flashcat.cloud"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 表示日志中匹配到2022开头的行 才发送 ")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"include_at_match"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"include_demo"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("pattern")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^2022*"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 表示186的手机号会被[186xxx] 代替")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mask_sequences"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mask_phone_number"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("replace_placeholder")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[186xxx]"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("pattern")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"186\\\\d{8}"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 表示以日期为日志的开头，多行的日志合并为一行进行采集  multi_line不支持全局处理规则")]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("type")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"multi_line"')]),s._v(" \n   "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("name")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"new_line_with_date"')]),s._v("\n   "),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("pattern")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"\\\\d{4}-\\\\d{2}-\\\\d{2}"')]),s._v(" （多行规则不需要添加^ ，代码会自动添加）\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br")])]),t("h2",{attrs:{id:"prometheus-toml-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-toml-配置"}},[s._v("#")]),s._v(" prometheus.toml 配置")]),s._v(" "),t("p",[t("code",[s._v("prometheus-agent")]),s._v("是为了兼容"),t("code",[s._v("prometheus agent mode")]),s._v("，所以我们也把它叫做"),t("code",[s._v("prometheus-agent")]),s._v("。它可以把"),t("code",[s._v("prometheus")]),s._v("采集配置直接拿来使用。")]),s._v(" "),t("div",{staticClass:"language-toml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("prometheus")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否启动prometheus agent")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("enable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 原来prometheus的配置文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者新建一个prometheus格式的配置文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("scrape_config_file")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/path/to/in_cluster_scrape.yaml"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 日志级别，支持 debug | warn | info | error")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("log_level")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"info"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以下配置文件，保持默认就好了")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## wal file storage path ,default ./data-agent")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# wal_storage_path="/path/to/storage"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## wal reserve time duration, default value is 2 hour")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wal_min_duration=2")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("Prometheus 自动采集 kube-state-metrics 指标的 scrape 配置：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("global")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_interval")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 15s\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("external_labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scraper")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ksm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("test\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cluster")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-state-metrics"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metrics_path")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/metrics"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kubernetes_sd_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("role")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" endpoints\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("api_server")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://172.31.0.1:443"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tls_config")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ca_file")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/kubernetes/pki/ca.crt\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cert_file")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/kubernetes/pki/apiserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client.crt\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key_file")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/kubernetes/pki/apiserver"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("kubelet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client.key\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("insecure_skip_verify")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scheme")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("relabel_configs")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("source_labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            __meta_kubernetes_namespace"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            __meta_kubernetes_service_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            __meta_kubernetes_endpoint_port_name"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("action")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" keep\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("regex")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" kube"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("system;kube"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("state"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("metrics;http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("metrics\n\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("remote_write")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("url")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://172.31.62.213/prometheus/v1/write'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br")])]),t("h2",{attrs:{id:"conf-input-toml配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#conf-input-toml配置"}},[s._v("#")]),s._v(" "),t("code",[s._v("conf/input.*/*.toml")]),s._v("配置")]),s._v(" "),t("p",[s._v("https://github.com/flashcatcloud/categraf/tree/main/inputs")]),s._v(" "),t("p",[s._v("inputs目录下对应插件的目录里面有 每个插件的使用方式，提供了 README 和默认配置，")]),s._v(" "),t("p",[t("code",[s._v("input.exec/exec.toml")])]),s._v(" "),t("p",[s._v("自定义实现指定业务的监控\n监控脚本采集到监控数据之后通过相应的格式输出到stdout，categraf截获stdout内容，解析之后传给服务端，")]),s._v(" "),t("div",{staticClass:"language-toml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-toml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # collect interval")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# interval = 15")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("instances")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # commands, support glob")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("commands")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/categraf/scripts/*/*.sh"')]),s._v("   "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 监控脚本所在位置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # timeout for each command to complete")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# timeout = 5")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # interval = global.interval * interval_times")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# interval_times = 1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# # mesurement,labelkey1=labelval1,labelkey2=labelval2 field1=1.2,field2=2.3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key property"}},[s._v("data_format")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"influx"')]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 脚本的输出格式支持3种：influx、falcon、prometheus")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("p",[s._v("查看采集器输出的监控指标，配置好 "),t("code",[s._v("conf/input.exec/exec.toml")]),s._v(" ，可以执行命令："),t("code",[s._v("./categraf --test --inputs exec")])])])}),[],!1,null,null,null);t.default=e.exports}}]);