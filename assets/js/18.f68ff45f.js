(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{341:function(s,a,t){"use strict";t.r(a);var e=t(4),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"logrotate入门及实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#logrotate入门及实践"}},[s._v("#")]),s._v(" Logrotate入门及实践")]),s._v(" "),a("h2",{attrs:{id:"一、logrotate介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、logrotate介绍"}},[s._v("#")]),s._v(" 一、logrotate介绍")]),s._v(" "),a("p",[s._v("logrotate是centos自带命令，其他linux操作系统可能需要自行安装，用来进行日志切割和定期删除，简单来说就是将某个日志文件按照时间或大小分割成多份，删除时间久远的日志。")]),s._v(" "),a("h2",{attrs:{id:"二、配置详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、配置详解"}},[s._v("#")]),s._v(" 二、配置详解")]),s._v(" "),a("p",[s._v("logrotate是基于crond服务（"),a("a",{attrs:{href:"https://so.csdn.net/so/search?q=%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"}},[s._v("定时任务"),a("OutboundLink")],1),s._v("）来运行的，")]),s._v(" "),a("p",[s._v("有几个重要的配置：")]),s._v(" "),a("p",[s._v("1、/etc/logrotate.conf（主配置）和/etc/logrotate.d/*（子配置）")]),s._v(" "),a("p",[s._v("/etc/logrotate.conf是全局配置，logrotate.conf里面包含include /etc/logrotate.d这句，加载子配置文件的意思，说明/etc/logrotate.d/目录下是具体的配置，一般是以服务名称命名，比如yum等配置。主配置和子配置有冲突时，以子配置的规则为准。")]),s._v(" "),a("p",[s._v("常用配置：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("compress")]),s._v("：通过 gzip，压缩转储以后的日志")]),s._v(" "),a("li",[a("code",[s._v("nocompress")]),s._v("：不需要压缩时，用这个参数")]),s._v(" "),a("li",[a("code",[s._v("copytruncate")]),s._v("：用于还在打开中的日志文件，把当前日志备份并截断")]),s._v(" "),a("li",[a("code",[s._v("nocopytruncate")]),s._v("：备份日志文件但是不截断")]),s._v(" "),a("li",[a("code",[s._v("createmodeownergroup")]),s._v("：转储文件，使用指定的文件模式创建新的日志文件")]),s._v(" "),a("li",[a("code",[s._v("nocreate")]),s._v("：不建立新的日志文件")]),s._v(" "),a("li",[a("code",[s._v("delaycompress")]),s._v("和"),a("code",[s._v("compress")]),s._v("：一起使用时，转储的日志文件到下一次转储时才压缩")]),s._v(" "),a("li",[a("code",[s._v("missingok")]),s._v("：在日志轮循期间，任何错误将被忽略，例如 “文件无法找到” 之类的错误。")]),s._v(" "),a("li",[a("code",[s._v("nodelaycompress")]),s._v("：覆盖 delaycompress 选项，转储同时压缩。")]),s._v(" "),a("li",[a("code",[s._v("errorsaddress")]),s._v("：专储时的错误信息发送到指定的 Email 地址")]),s._v(" "),a("li",[a("code",[s._v("ifempty")]),s._v("：即使是空文件也转储，这个是 logrotate 的缺省选项。")]),s._v(" "),a("li",[a("code",[s._v("notifempty")]),s._v("：如果是空文件的话，不转储")]),s._v(" "),a("li",[a("code",[s._v("mailaddress")]),s._v("：把转储的日志文件发送到指定的 E-mail 地址")]),s._v(" "),a("li",[a("code",[s._v("nomail")]),s._v("：转储时不发送日志文件")]),s._v(" "),a("li",[a("code",[s._v("dateext")]),s._v("：转储后的日志文件以日期命名")]),s._v(" "),a("li",[a("code",[s._v("olddirdirectory")]),s._v("：转储后的日志文件放入指定的目录，必须和当前日志文件在同一个文件系统")]),s._v(" "),a("li",[a("code",[s._v("noolddir")]),s._v("：转储后的日志文件和当前日志文件放在同一个目录下")]),s._v(" "),a("li",[a("code",[s._v("prerotate/endscript")]),s._v("：在转储以前需要执行的命令可以放入这个对，这两个关键字必须单独成行")]),s._v(" "),a("li",[a("code",[s._v("postrotate/endscript")]),s._v("：在转储以后需要执行的命令可以放入这个对，这两个关键字必须单独成行")]),s._v(" "),a("li",[a("code",[s._v("daily")]),s._v("：指定转储周期为每天")]),s._v(" "),a("li",[a("code",[s._v("weekly")]),s._v("：指定转储周期为每周")]),s._v(" "),a("li",[a("code",[s._v("monthly")]),s._v("：指定转储周期为每月")]),s._v(" "),a("li",[a("code",[s._v("rotatecount")]),s._v("：指定日志文件删除之前转储的次数，0 指没有备份，5 指保留 5 个备份")]),s._v(" "),a("li",[a("code",[s._v("size")]),s._v("（或 minsize）：size 当日志文件到达指定的大小时才转储，Size 可以指定 bytes(缺省) 以及 KB(sizek) 或者 MB(sizem)")])]),s._v(" "),a("h2",{attrs:{id:"三、案例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、案例"}},[s._v("#")]),s._v(" 三、案例")]),s._v(" "),a("p",[s._v("在 "),a("code",[s._v("/etc/logrotate.d")]),s._v("下添加如下配置：")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/logrotate.d/nginx\n/data/log/access.log\n/data/log/error.log\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    daily\n    dateext\n    missingok\n    rotate "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("\n    notifempty\n    create "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("755")]),s._v(" www\n    sharedscripts\n    postrotate\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /var/run/nginx.pid "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-USR1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /var/run/nginx.pid"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n    endscript\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 测试")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("logrotate")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /etc/logrotate.d/nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"日志量大"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日志量大"}},[s._v("#")]),s._v(" 日志量大")]),s._v(" "),a("p",[s._v("有时候可能日志量非常大，默认的按天切割就不能够满足我们的需求，磁盘可能很快就会满，这时候可以将策略自定义为每小时执行一次。")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/logrotate.d/nginx\n/data/log/access.log\n/data/log/error.log\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    hourly\n    dateext\n    missingok\n    rotate "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("\n    notifempty\n    create "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("755")]),s._v(" www\n    sharedscripts\n    postrotate\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" /var/run/nginx.pid "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-USR1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /var/run/nginx.pid"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n    endscript\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 往小时执行池子里拷贝一份：")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /etc/cron.daily/logrotate /etc/cron.hourly/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);