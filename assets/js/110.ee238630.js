(window.webpackJsonp=window.webpackJsonp||[]).push([[110],{429:function(s,a,t){"use strict";t.r(a);var n=t(4),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"mtail介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mtail介绍"}},[s._v("#")]),s._v(" mtail介绍")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/google/mtail",target:"_blank",rel:"noopener noreferrer"}},[s._v("mtail"),a("OutboundLink")],1),s._v(" 是谷歌开源的一款从应用日志中提取  metrics 的工具。categraf 将 mtail 作为一个插件集成了进来，并且兼容 mtail 的语法，简化了部署。原本 mtail  和日志文件之间是一对一的关系，即一般都是一个 mtail  进程处理一类日志，但是对于很高配的物理机，上面会部署很多不同的服务，每个服务进程都对应一个 mtail，此时机器上会出现特别多的 mtail  进程，较难维护。把 mtail 集成到 categraf 之后，复用 categraf 的多实例插件机制，可以做到一台机器上只有一个  categraf 进程即可读取解析多个服务的日志。示例图如下：")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://flashcat.cloud/images/blog/categraf/mtail.png",alt:"Mtail"}})]),s._v(" "),a("p",[s._v("如何使用categraf的mtail插件从日志中提取metrics")]),s._v(" "),a("p",[s._v("mtail的github项目地址 https://github.com/flashcatcloud/categraf/tree/main/inputs/mtail")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/google/mtail/releases/download/v3.0.0-rc51/mtail_3.0.0-rc51_Linux_x86_64.tar.gz\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" xf mtail_3.0.0-rc51_Linux_x86_64.tar.gz\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" mtail /usr/local/bin\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看mtail版本")]),s._v("\n$ mtail "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--version")]),s._v("\nmtail version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.0")]),s._v(".0-rc51 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" revision 6fdbf8ec96a63c674c53148eeb9ec96043a2ec9c go version go1.19.4 go arch amd64 go os linux\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mtail后台启动")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" mtail "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-port")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3903")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-logtostderr")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-progs")]),s._v(" test.mtail "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-logs")]),s._v(" test.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认端口是3903")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" ./mtail "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-progs")]),s._v(" test.mtail "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-logs")]),s._v(" test.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看是否启动成功")]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ef")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" mtail\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看mtail的帮助文档")]),s._v("\n$ mtail "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-h")]),s._v("\n一般情况下使用的就两个参数\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-progs")]),s._v(" 定义mtail脚本程序所在路径\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-logs")]),s._v(" 定义我们要读取的日志文件的路径\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("p",[s._v("多个日志在同一个文件夹里的时，使用谷歌的mtail采集的指标可能会混淆，出现日志错乱，不同的指标收集到了其他的日志文件里面\n如果要解决这个问题，就需要给每个日志启动不同的"),a("code",[s._v("mtail")]),s._v(",一个 mtail 进程处理一类日志\nCategraf 对 mtail 插件做了优化，优化后的 mtail 插件可以做到一个 Categraf 进程采集多个日志")]),s._v(" "),a("h1",{attrs:{id:"categraf-mtail日志采集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#categraf-mtail日志采集"}},[s._v("#")]),s._v(" categraf-mtail日志采集")]),s._v(" "),a("p",[s._v("进入"),a("code",[s._v("input.mtail")]),s._v("文件夹，编辑"),a("code",[s._v("mtail.toml")])]),s._v(" "),a("div",{staticClass:"language-toml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-toml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("instances")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("progs")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/categraf-v0.2.38-linux-amd64/conf/input.mtail/prog-1"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("logs")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/categraf-v0.2.38-linux-amd64/conf/input.mtail/logs/a.log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# override_timezone = "Asia/Shanghai"  #时区')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# emit_metric_timestamp = "true" #string type')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("instances")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("progs")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/categraf-v0.2.38-linux-amd64/conf/input.mtail/prog-2"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("logs")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/categraf-v0.2.38-linux-amd64/conf/input.mtail/logs/b.log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# override_timezone = "Asia/Shanghai"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# emit_metric_timestamp = "true" # string type')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("p",[s._v("添加需要的目录以及脚本：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /opt "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" mtail   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个专门的mtail测试案列文件夹")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" logs  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" logs\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" a.log\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" b.log\n \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" progs-1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" progs-1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" a.mtail \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" progs-2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" progs-2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" b.mtail\n \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" a.mtail\ngauge err_cnt \n/ERROR.*/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      err_cnt++\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" b.mtail\ngauge foo_cnt \n/dream.*/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      foo_cnt++\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v("测试模式启动categraf")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用测试模式启动")]),s._v("\n$ ./categraf "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-test")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-inputs")]),s._v(" mtail'\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# a.log写入err日志")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"err"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" logs/a.log\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# b.log写入foo日志")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"foo"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" logs/b.log\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("看到指标增加了：")]),s._v(" "),a("div",{staticClass:"language-less line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-less"}},[a("code",[a("span",{pre:!0,attrs:{class:"token property"}},[s._v("05")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("42")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("33 mtail_err_cnt agent_hostname=n9e 1\n"),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("05")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("42")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("48 mtail_err_cnt agent_hostname=n9e 1\n\n"),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("05")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("43")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("28 mtail_foo_cnt agent_hostname=n9e 1\n"),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("05")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token property"}},[s._v("43")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("43 mtail_foo_cnt agent_hostname=n9e 1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("向"),a("code",[s._v("a.log")]),s._v("增加"),a("code",[s._v("foo")]),s._v("的日志，观察"),a("code",[s._v("foo_count")]),s._v("指标 不会增加")]),s._v(" "),a("p",[s._v("Categraf 就解决了不同日志指标错乱的问题。")]),s._v(" "),a("p",[s._v("想给不同的"),a("code",[s._v("instance")]),s._v("指定"),a("code",[s._v("label")])]),s._v(" "),a("div",{staticClass:"language-toml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-toml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("instances")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("progs")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/categraf-v0.2.38-linux-amd64/conf/input.mtail/prog-1"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("logs")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/categraf-v0.2.38-linux-amd64/conf/input.mtail/logs/a.log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("labels")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v('"app"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"err"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# override_timezone = "Asia/Shanghai"  #时区')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# emit_metric_timestamp = "true" #string type')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token table class-name"}},[s._v("instances")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("progs")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/categraf-v0.2.38-linux-amd64/conf/input.mtail/prog-2"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("logs")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/opt/categraf-v0.2.38-linux-amd64/conf/input.mtail/logs/b.log"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v("labels")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token key property"}},[s._v('"app"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"foo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# override_timezone = "Asia/Shanghai"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# emit_metric_timestamp = "true" # string type')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("mtail规则文件 增加env变量")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义常量label env")]),s._v("\nhidden text "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("env")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 给label 赋值 这样定义是global范围;")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 局部添加，则在对应的condition中添加")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("env")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"production"')]),s._v("\ngauge err_cnt \n/ERROR.*/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      err_cnt++\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);